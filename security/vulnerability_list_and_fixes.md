# 漏洞清單與修復方案

**日期**：2026-02-15 | **專利**：TW-115100981 | **公司**：小路光有限公司
**安全分數**：72/100（C 級）| **檢測工具**：self_audit.py v2.0（10/10 實作）

---

## 一、漏洞總覽

| 狀態 | 數量 | 扣分 |
|------|------|------|
| VULNERABLE | 3 | -28 |
| SAFE | 7 | 0 |
| **總分** | **10 項** | **72/100** |

---

## 二、VULNERABLE 漏洞詳情（需修復）

### VULN-002：API 金鑰洩漏（嚴重度：Critical，-15 分）

**發現位置**：12 個檔案

| # | 檔案 | 類型 | 數量 |
|---|------|------|------|
| 1 | .mcp.json | Supabase Access Token | 1 |
| 2 | chat.html | JWT Token | 1 |
| 3 | command-center.html | JWT Token | 1 |
| 4 | dashboard.html | JWT Token | 1 |
| 5 | dual-dashboard.html | JWT Token | 1 |
| 6 | index.html | JWT Token | 1 |
| 7 | nvidia-chat.html | JWT Token | 1 |
| 8 | streamlit-dashboard.py | JWT Token | 1 |
| 9 | system-monitor.py | JWT Token | 1 |
| 10 | pages-site/assets/index-BedVsTGe.js | JWT Token | 4 |
| 11 | py_backup/streamlit-dashboard.py | JWT Token | 1 |
| 12 | py_backup/system-monitor.py | JWT Token | 1 |

**修復方案**：
1. 將所有 JWT token 移至環境變數 `SUPABASE_ANON_KEY`
2. HTML 檔案改用 `<script>` 從伺服器端注入
3. .mcp.json 加入 .gitignore
4. py_backup/ 中的舊檔案刪除或清理
5. pages-site/assets/ 重新打包時排除硬編碼 token

**預計完成時間**：1-2 天

---

### VULN-003：資料外洩（嚴重度：High，-10 分）

**發現位置**：5 個洩漏點

| # | 檔案 | 類型 | 數量 |
|---|------|------|------|
| 1 | 設備安裝報告.md | 信用卡號碼模式 | 1 |
| 2 | pages-site/assets/index-BedVsTGe.js | 信用卡號碼模式 | 7 |
| 3 | pages-site/assets/index-BedVsTGe.js | 明文密碼 | 2 |
| 4 | supabase/tests/oauth_mcp_example_l4.py | 明文密鑰 | 1 |
| 5 | supabase/tests/test_aml_kyc_l4.py | 台灣身分證字號 | 1 |

**修復方案**：
1. test_aml_kyc_l4.py 中的身分證字號改為格式正確但無效的測試值（如 A000000000）
2. oauth_mcp_example_l4.py 中的密鑰改為佔位符 `<YOUR_SECRET_HERE>`
3. pages-site/assets/ 重新打包時移除敏感資料
4. 設備安裝報告.md 中確認信用卡號碼是否為真實資料（如是則遮罩）

**預計完成時間**：1 天

---

### VULN-010：不安全隨機數（嚴重度：Low，-3 分）

**發現位置**：9 個檔案（6 個無安全替代）

| # | 檔案 | 類型 | 有安全替代 |
|---|------|------|-----------|
| 1 | monitor_tasks.py | Python random | 無 |
| 2 | self_audit.py | JS Math.random() | 無 |
| 3 | system-monitor.py | Python random | 無 |
| 4 | task_generator.py | Python random | 有 |
| 5 | avatar-3d/index.html | JS Math.random() | 無 |
| 6 | pages-site/assets/index-BedVsTGe.js | JS Math.random() | 有 |
| 7 | py_backup/monitor_tasks.py | Python random | 無 |
| 8 | py_backup/system-monitor.py | Python random | 無 |
| 9 | py_backup/task_generator.py | Python random | 有 |

**修復方案**：
1. Python 檔案：`import random` → `import secrets`，使用 `secrets.randbelow()` 取代 `random.randint()`
2. JS 檔案：`Math.random()` → `crypto.getRandomValues()` 或 `crypto.randomUUID()`
3. py_backup/ 為備份目錄，可考慮整包刪除

**預計完成時間**：半天

---

## 三、SAFE 項目摘要（無需立即處理）

| 項目 | 狀態 | 備註 |
|------|------|------|
| VULN-001 Prompt Injection | SAFE | 有 sanitize/BLOCKED_PATTERNS 防護 |
| VULN-004 權限提升 | SAFE | 4/5 防護通過（auth middleware + RLS） |
| VULN-005 SQL Injection | SAFE | 0 風險，406 個安全參數化查詢 |
| VULN-006 DoS | SAFE | rate limiter + size limit + test |
| VULN-007 日誌注入 | SAFE | 有風險但 JSON.stringify 結構化緩解 |
| VULN-008 依賴套件 | SAFE | 無已知漏洞，有 lockfile |
| VULN-009 XSS | SAFE | 14 個風險點但有 CSP + X-XSS-Protection |

### SAFE 但需關注的項目

- **VULN-007**：2 個日誌注入點在 index-BedVsTGe.js 中
- **VULN-009**：14 個 innerHTML/eval 使用，僅因有安全標頭判定 SAFE

---

## 四、修復優先順序

| 優先級 | 項目 | 預期分數提升 | 難度 |
|--------|------|-------------|------|
| P0 | VULN-002 金鑰清理 | +15 分 → 87 分 | 中 |
| P1 | VULN-003 資料清理 | +10 分 → 97 分 | 低 |
| P2 | VULN-010 隨機數替換 | +3 分 → 100 分 | 低 |

**全部修復後預期分數：100/100（A+）**

---

*SEOBAIKE — 專利 TW-115100981 | 小路光有限公司*
