<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>SEOBAIKE AI — 全系統總控台</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Segoe UI',sans-serif; background:#0a0a1a; color:#eee; min-height:100vh; }
.header { background:linear-gradient(135deg,#76b900 0%,#e8850c 50%,#1a1a2e 100%); padding:20px 30px; text-align:center; }
.header h1 { font-size:28px; color:#fff; }
.header p { color:#ccc; margin-top:5px; }
.live { display:inline-block; width:10px; height:10px; border-radius:50%; background:#0f0; animation:pulse 1s infinite; margin-right:8px; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.2} }
@keyframes rotate { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
.stats { display:grid; grid-template-columns:repeat(5,1fr); gap:12px; padding:20px 30px; }
.stat { background:#16213e; border:1px solid #333; border-radius:12px; padding:15px; text-align:center; cursor:default; }
.stat .num { font-size:36px; font-weight:bold; color:#76b900; }
.stat .lbl { font-size:11px; color:#888; margin-top:4px; }
.grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(380px,1fr)); gap:16px; padding:0 30px 20px; }
.panel { background:#16213e; border:1px solid #333; border-radius:16px; overflow:hidden; transition:all 0.3s; }
.panel:hover { border-color:#76b900; transform:translateY(-3px); box-shadow:0 8px 30px rgba(118,185,0,0.2); }
.panel h3 { padding:12px 16px; background:#1a1a2e; font-size:14px; display:flex; align-items:center; gap:8px; }
.panel iframe { width:100%; height:500px; border:none; background:#0a0a1a; }
.panel .badge { padding:3px 8px; border-radius:10px; font-size:10px; font-weight:bold; }
.spinner { display:inline-block; width:14px; height:14px; border:2px solid #333; border-top:2px solid #76b900; border-radius:50%; animation:rotate 1s linear infinite; }
.footer { text-align:center; padding:20px; color:#555; font-size:11px; }
.clock { font-size:18px; color:#76b900; font-family:monospace; }
.status-ok { color:#76b900; }
.status-warn { color:#e8850c; }
</style>
</head>
<body>

<div class="header">
  <h1><span class="live"></span> SEOBAIKE AI — 全系統總控台</h1>
  <p>專利 115100981 | 小路光有限公司 | 許竣翔 指揮官 | <span class="clock" id="clock"></span></p>
</div>

<div class="stats" id="liveStats">
  <div class="stat"><div class="num" id="s-providers">--</div><div class="lbl">AI 供應商</div></div>
  <div class="stat"><div class="num" id="s-keys">--</div><div class="lbl">API Keys</div></div>
  <div class="stat"><div class="num" id="s-health">--</div><div class="lbl">系統元件</div></div>
  <div class="stat"><div class="num" id="s-crons">14</div><div class="lbl">排程任務</div></div>
  <div class="stat"><div class="num" id="s-uptime" style="color:#e8850c;">0</div><div class="lbl">運行秒數</div></div>
</div>

<div class="grid">
  <div class="panel">
    <h3><span class="spinner"></span> 指揮中心聊天 <span class="badge" style="background:#76b900;color:#000;">NVIDIA NIM</span></h3>
    <iframe src="nvidia-chat.html"></iframe>
  </div>
  <div class="panel">
    <h3><span class="spinner"></span> AI 儀錶板 <span class="badge" style="background:#e8850c;color:#fff;">即時數據</span></h3>
    <iframe src="pages-site/dashboard.html"></iframe>
  </div>
  <div class="panel">
    <h3><span class="spinner"></span> 生態系統 <span class="badge" style="background:#cc785c;color:#fff;">91 平台</span></h3>
    <iframe src="pages-site/ecosystem.html"></iframe>
  </div>
  <div class="panel">
    <h3><span class="spinner"></span> AI 引擎 <span class="badge" style="background:#76b900;color:#000;">19 模型</span></h3>
    <iframe src="pages-site/ai.html"></iframe>
  </div>
  <div class="panel">
    <h3><span class="spinner"></span> 市集 <span class="badge" style="background:#f37726;color:#fff;">插拔式</span></h3>
    <iframe src="pages-site/marketplace.html"></iframe>
  </div>
  <div class="panel">
    <h3><span class="spinner"></span> 帳務系統 <span class="badge" style="background:#e8850c;color:#fff;">後付制</span></h3>
    <iframe src="pages-site/billing.html"></iframe>
  </div>
</div>

<div class="footer">
  SEOBAIKE AI — 專利 115100981 — 小路光有限公司 — 全系統運行中 — <span id="ft"></span>
</div>

<script src="seobaike-config.js"></script>
<script>
const _cfg = window.__SEOBAIKE__ || {};
const SB_URL = _cfg.supabaseUrl || 'https://vmyrivxxibqydccurxug.supabase.co';
const SB_KEY = _cfg.anonKey || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZteXJpdnh4aWJxeWRjY3VyeHVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNDAwMjksImV4cCI6MjA4NTYxNjAyOX0.iBV-23LGdm_uKffAExgqSV34-NWoAyv8_-M_cJQZ8Gg';
const startTime = Date.now();

// 時鐘 + 運行秒數
setInterval(() => {
  document.getElementById("clock").textContent = new Date().toLocaleString("zh-TW");
  document.getElementById("s-uptime").textContent = Math.floor((Date.now()-startTime)/1000);
}, 1000);

// 載入即時數據
async function loadStats() {
  const headers = { "apikey": SB_KEY, "Authorization": "Bearer " + SB_KEY };
  try {
    const [pRes, kRes, hRes] = await Promise.all([
      fetch(SB_URL + "/rest/v1/ai_providers?select=id,name,is_active", { headers }),
      fetch(SB_URL + "/rest/v1/app_secrets?select=key", { headers }),
      fetch(SB_URL + "/rest/v1/system_health?select=component,status", { headers })
    ]);
    const providers = await pRes.json();
    const keys = await kRes.json();
    const health = await hRes.json();

    const providerArr = Array.isArray(providers) ? providers : [];
    const keyArr = Array.isArray(keys) ? keys : [];
    const healthArr = Array.isArray(health) ? health : [];

    const onlineCount = providerArr.filter(p => p.is_active).length;
    const totalProviders = providerArr.length;
    const healthyCount = healthArr.filter(h => h.status === 'healthy').length;
    const totalHealth = healthArr.length;

    document.getElementById("s-providers").textContent = onlineCount + "/" + totalProviders;
    document.getElementById("s-providers").className = "num status-ok";
    document.getElementById("s-keys").textContent = keyArr.length;
    document.getElementById("s-keys").className = "num status-ok";
    document.getElementById("s-health").textContent = healthyCount + "/" + totalHealth;
    document.getElementById("s-health").className = "num status-ok";
  } catch(e) {
    document.getElementById("s-providers").textContent = "ERR";
    document.getElementById("s-providers").style.color = "#ff5f57";
  }
}

loadStats();
// 每 60 秒更新一次（不燒 credit）
setInterval(loadStats, 60000);

document.getElementById("ft").textContent = new Date().toLocaleString("zh-TW");
</script>
</body>
</html>
