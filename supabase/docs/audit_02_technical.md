# MCP 主權 OS — L1-L4 審計技術版

> 含資料流、邊界圖、禁止路徑圖。
> 可直接貼進技術審計文件或架構審查簡報。

---

## 資料流（Data Flow）

```
[L1 資料層]
   |（唯讀）
   v
[L2 推論層]
   |（推論結果）
   v
[L3 流程層]
   |（狀態變更）
   v
[外部系統 / 金流 / 通知]
```

---

## 邊界圖（Jurisdiction Boundary）

```
+------------------------------+
|            L4                |
|   治理、自動化、策略          |
+---------------^--------------+
                | 禁止跨層
+---------------+--------------+
|            L3                |
|   流程、事件、狀態變更        |
+---------------^--------------+
                | 禁止跨層
+---------------+--------------+
|            L2                |
|   推論、規則、不可寫入        |
+---------------^--------------+
                | 禁止跨層
+---------------+--------------+
|            L1                |
|   資料結構、法遵、不可變      |
+------------------------------+
```

---

## 禁止路徑（Prohibited Paths）

- **L1** -> 不得引用任何上層
- **L2** -> 不得寫入 L1，不得觸發流程
- **L3** -> 不得跳過 L2 推論
- **L4** -> 不得直接操作 L1，不得跳過 L3

## 禁止路徑矩陣（Prohibited Path Matrix）

| 來源層 -> 目標層 | L1 | L2 | L3 | L4 |
|-----------------|----|----|----|----|
| **L1** | -- | 禁止引用 | 禁止引用 | 禁止引用 |
| **L2** | 唯讀 | -- | 禁止引用 | 禁止引用 |
| **L3** | 讀寫（透過 API） | 呼叫推論 | -- | 禁止引用 |
| **L4** | 禁止直接操作 | 可編排 | 可觸發 | -- |

---

## 檔案歸戶（File Assignment）

### L1 — 主權資料層

| 檔案 | 審計定位 | 跨層引用 |
|------|----------|----------|
| schema_core.sql | 核心資料邊界 | 無 |
| schema_compliance_tw.sql | 法遵資料邊界 | 無 |
| schema_commission_anti_kickback.sql | 金流與反傭資料邊界 | 無 |
| schema_aml.sql | 反洗錢資料邊界 | 無 |
| schema_kyc.sql | 身分驗證資料邊界 | 無 |

### L2 — 推論與規則層

| 檔案 | 審計定位 | 資料來源 | 寫入行為 |
|------|----------|----------|----------|
| aml_engine.ts | AML 推論引擎 | L1 aml_rules, transactions | 無 |
| kyc_engine.ts | KYC 推論引擎 | L1 kyc_documents | 無 |

### L3 — 流程與執行層

| 檔案 | 審計定位 | 引用 L1 | 引用 L2 | 狀態變更 |
|------|----------|---------|---------|----------|
| edge/order_created.ts | 訂單流程控制 | orders, merchants, compliance_checks | KYC 狀態判定 | commission_payouts INSERT |
| edge/payment_captured.ts | 金流流程控制 | payments, orders, commission_rules | 佣金計算, 反傭偵測 | commission_payouts UPDATE, risk_flags INSERT |

### L4 — 自動化與治理層

本批檔案無 L4 內容。符合邊界分離原則。

---

> 台灣專利 115100981「世界定義約束法用於AI推理」
> 小路光有限公司（統編 60475510）
> 架構師：許竣翔
