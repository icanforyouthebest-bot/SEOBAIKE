<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>SEOBAIKE WAR ROOM | 許竣翔 指揮官</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
<style>
:root{--bg:#000;--g1:#00ff88;--g2:#00cc6a;--r1:#ff2244;--r2:#cc1133;--b1:#00aaff;--b2:#0066cc;--gold:#ffaa00;--purple:#aa44ff;--cyan:#00eeff;--white:#e8e8e8;--dim:rgba(255,255,255,0.12);--card:rgba(8,12,20,0.92)}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{background:#000;color:var(--white);font-family:'JetBrains Mono','Noto Sans TC',monospace}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:var(--g1);border-radius:4px}

/* === MATRIX RAIN CANVAS === */
#matrix{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;opacity:0.06}

/* === GRID OVERLAY === */
.grid-overlay{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none;
  background-image:linear-gradient(rgba(0,255,136,0.015) 1px,transparent 1px),linear-gradient(90deg,rgba(0,255,136,0.015) 1px,transparent 1px);
  background-size:60px 60px}

/* === HUD BORDER === */
.hud-border{position:fixed;top:0;left:0;right:0;bottom:0;z-index:2;pointer-events:none;border:1px solid rgba(0,255,136,0.08)}
.hud-corner{position:absolute;width:40px;height:40px;z-index:3}
.hud-corner.tl{top:0;left:0;border-top:2px solid var(--g1);border-left:2px solid var(--g1)}
.hud-corner.tr{top:0;right:0;border-top:2px solid var(--g1);border-right:2px solid var(--g1)}
.hud-corner.bl{bottom:0;left:0;border-bottom:2px solid var(--g1);border-left:2px solid var(--g1)}
.hud-corner.br{bottom:0;right:0;border-bottom:2px solid var(--g1);border-right:2px solid var(--g1)}

/* === SCANLINE === */
.scanline{position:fixed;top:0;left:0;width:100%;height:2px;background:linear-gradient(90deg,transparent,var(--g1),transparent);z-index:999;pointer-events:none;animation:scan 6s linear infinite;opacity:0.3}
@keyframes scan{0%{top:-2px}100%{top:100vh}}

/* === LAYOUT === */
.app{position:relative;z-index:10;height:100vh;display:grid;grid-template-rows:auto auto 1fr auto;overflow:hidden}

/* === TOP BAR === */
.topbar{display:flex;align-items:center;justify-content:space-between;padding:8px 20px;background:rgba(0,0,0,0.9);border-bottom:1px solid rgba(0,255,136,0.15)}
.tb-left{display:flex;align-items:center;gap:14px}
.logo-svg{width:36px;height:36px;filter:drop-shadow(0 0 8px rgba(0,255,136,0.4));animation:logoSpin 20s linear infinite}
@keyframes logoSpin{0%{filter:drop-shadow(0 0 8px rgba(0,255,136,0.4)) hue-rotate(0deg)}50%{filter:drop-shadow(0 0 16px rgba(0,170,255,0.6)) hue-rotate(40deg)}100%{filter:drop-shadow(0 0 8px rgba(0,255,136,0.4)) hue-rotate(0deg)}}
.brand{font-family:'Orbitron',monospace;font-size:15px;font-weight:800;letter-spacing:3px;color:var(--g1);text-shadow:0 0 20px rgba(0,255,136,0.3)}
.brand sub{font-size:9px;color:var(--gold);font-weight:400;letter-spacing:1px;margin-left:6px}
.tb-right{display:flex;align-items:center;gap:20px}
.live-indicator{display:flex;align-items:center;gap:6px}
.live-dot{width:8px;height:8px;border-radius:50%;background:var(--g1);box-shadow:0 0 12px var(--g1);animation:pulse 1.5s ease-in-out infinite}
@keyframes pulse{0%,100%{box-shadow:0 0 8px var(--g1)}50%{box-shadow:0 0 24px var(--g1),0 0 48px rgba(0,255,136,0.2)}}
.live-text{font-size:10px;font-weight:700;color:var(--g1);letter-spacing:3px}
.clock{font-size:11px;color:rgba(255,255,255,0.4)}
.commander-name{font-family:'Noto Sans TC',sans-serif;font-size:12px;font-weight:700;color:var(--gold);text-shadow:0 0 10px rgba(255,170,0,0.3)}

/* === STATUS STRIP === */
.status-strip{display:flex;align-items:center;gap:0;background:rgba(0,255,136,0.03);border-bottom:1px solid rgba(0,255,136,0.08);overflow:hidden;height:32px}
.ss-item{display:flex;align-items:center;gap:6px;padding:0 16px;height:100%;font-size:10px;font-weight:600;letter-spacing:1px;border-right:1px solid rgba(0,255,136,0.08);white-space:nowrap;animation:ssGlow 4s ease-in-out infinite}
.ss-item:nth-child(odd){animation-delay:0s}.ss-item:nth-child(even){animation-delay:2s}
@keyframes ssGlow{0%,100%{opacity:0.6}50%{opacity:1}}
.ss-dot{width:5px;height:5px;border-radius:50%;flex-shrink:0}
.ss-ok .ss-dot{background:var(--g1);box-shadow:0 0 6px var(--g1)}
.ss-ok{color:var(--g1)}
.ss-err .ss-dot{background:var(--r1);box-shadow:0 0 6px var(--r1)}
.ss-err{color:var(--r1)}
.ss-warn{color:var(--gold)}
.ss-warn .ss-dot{background:var(--gold);box-shadow:0 0 6px var(--gold)}
.ss-scroll{display:flex;animation:scrollStrip 40s linear infinite}
@keyframes scrollStrip{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
.patent-badge{padding:0 16px;height:100%;display:flex;align-items:center;font-size:10px;color:var(--gold);letter-spacing:2px;border-left:1px solid rgba(255,170,0,0.2);animation:patentFlash 3s ease-in-out infinite}
@keyframes patentFlash{0%,100%{text-shadow:none}50%{text-shadow:0 0 10px rgba(255,170,0,0.5)}}

/* === MAIN CONTENT === */
.content{overflow-y:auto;padding:12px;display:grid;grid-template-columns:280px 1fr 300px;gap:12px}
@media(max-width:1200px){.content{grid-template-columns:1fr 1fr}}
@media(max-width:768px){.content{grid-template-columns:1fr}}

/* === PANELS === */
.panel{background:var(--card);border:1px solid rgba(0,255,136,0.08);border-radius:4px;overflow:hidden;animation:panelIn 0.5s ease-out both}
@keyframes panelIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.panel:nth-child(1){animation-delay:0.05s}.panel:nth-child(2){animation-delay:0.1s}.panel:nth-child(3){animation-delay:0.15s}
.panel-head{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:rgba(0,255,136,0.03);border-bottom:1px solid rgba(0,255,136,0.08)}
.panel-title{font-family:'Orbitron',monospace;font-size:10px;font-weight:700;letter-spacing:2px;color:rgba(255,255,255,0.5);text-transform:uppercase}
.panel-badge{font-size:9px;font-weight:700;padding:2px 8px;border-radius:3px;letter-spacing:1px}
.pb-g{background:rgba(0,255,136,0.1);color:var(--g1);border:1px solid rgba(0,255,136,0.2)}
.pb-r{background:rgba(255,34,68,0.1);color:var(--r1);border:1px solid rgba(255,34,68,0.2);animation:pbFlash 1.5s infinite}
@keyframes pbFlash{0%,100%{opacity:1}50%{opacity:0.4}}
.pb-b{background:rgba(0,170,255,0.1);color:var(--b1);border:1px solid rgba(0,170,255,0.2)}
.pb-y{background:rgba(255,170,0,0.1);color:var(--gold);border:1px solid rgba(255,170,0,0.2)}
.panel-body{padding:10px 14px}

/* === SOLDIER ROW === */
.soldier-row{display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.03);transition:background 0.2s}
.soldier-row:last-child{border:none}
.soldier-row:hover{background:rgba(0,255,136,0.02)}
.sr-status{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.sr-on{background:var(--g1);box-shadow:0 0 8px var(--g1);animation:pulse 2s infinite}
.sr-off{background:var(--r1);box-shadow:0 0 8px var(--r1);animation:pbFlash 1s infinite}
.sr-name{font-size:11px;font-weight:600;color:var(--white);flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.sr-ms{font-size:10px;min-width:50px;text-align:right}
.sr-cost{font-size:9px;min-width:35px;text-align:right;opacity:0.4}
.ms-fast{color:var(--g1)}.ms-med{color:var(--gold)}.ms-slow{color:var(--r1)}

/* === RADAR === */
.radar-container{width:100%;aspect-ratio:1;max-width:240px;margin:0 auto;position:relative}
.radar-svg{width:100%;height:100%}
.radar-sweep{transform-origin:center;animation:sweep 3s linear infinite}
@keyframes sweep{to{transform:rotate(360deg)}}
.radar-blip{animation:blip 3s ease-in-out infinite}
@keyframes blip{0%,100%{opacity:0.2;r:2}50%{opacity:1;r:4}}

/* === METRIC BLOCK === */
.metric{text-align:center;padding:10px 0}
.metric-val{font-family:'Orbitron',monospace;font-size:28px;font-weight:900;line-height:1}
.metric-label{font-size:9px;letter-spacing:2px;color:rgba(255,255,255,0.3);margin-top:4px;text-transform:uppercase}
.metric-bar{height:2px;background:rgba(255,255,255,0.05);margin-top:6px;border-radius:1px;overflow:hidden}
.metric-fill{height:100%;border-radius:1px;transition:width 1s;position:relative}
.metric-fill::after{content:'';position:absolute;top:0;right:0;width:20px;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.5));animation:shimmer 1.5s linear infinite}
@keyframes shimmer{0%{opacity:0}50%{opacity:1}100%{opacity:0}}

/* === LOG FEED === */
.log-feed{max-height:200px;overflow-y:auto}
.log-entry{padding:4px 0;font-size:10px;border-bottom:1px solid rgba(255,255,255,0.02);animation:logIn 0.3s ease-out}
@keyframes logIn{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:translateX(0)}}
.log-time{color:rgba(255,255,255,0.15);margin-right:6px}
.log-type{font-weight:700;margin-right:6px;padding:1px 4px;border-radius:2px;font-size:9px}
.lt-patrol{background:rgba(0,170,255,0.15);color:var(--b1)}
.lt-heal{background:rgba(0,255,136,0.15);color:var(--g1)}
.lt-alert{background:rgba(255,34,68,0.15);color:var(--r1)}
.lt-access{background:rgba(255,170,0,0.15);color:var(--gold)}
.log-msg{color:rgba(255,255,255,0.4)}

/* === PHYSICAL AI === */
.pai-flow{display:flex;align-items:center;gap:4px;padding:8px;background:rgba(0,0,0,0.3);border-radius:4px;margin-top:8px;overflow-x:auto;flex-wrap:nowrap}
.pai-node{padding:4px 8px;border-radius:3px;font-size:9px;font-weight:700;white-space:nowrap;position:relative}
.pai-node::after{content:'';position:absolute;bottom:-2px;left:0;right:0;height:1px;animation:nodeActive 2s ease-in-out infinite}
.pai-l1{background:rgba(0,238,255,0.1);color:var(--cyan);border:1px solid rgba(0,238,255,0.2)}.pai-l1::after{background:var(--cyan)}
.pai-l2{background:rgba(0,255,136,0.1);color:var(--g1);border:1px solid rgba(0,255,136,0.2)}.pai-l2::after{background:var(--g1)}
.pai-l3{background:rgba(255,170,0,0.1);color:var(--gold);border:1px solid rgba(255,170,0,0.2)}.pai-l3::after{background:var(--gold)}
.pai-l4{background:rgba(255,34,68,0.1);color:var(--r1);border:1px solid rgba(255,34,68,0.2)}.pai-l4::after{background:var(--r1)}
.pai-arrow{color:rgba(0,255,136,0.3);font-size:10px;animation:arrowFlow 1s ease-in-out infinite}
@keyframes arrowFlow{0%,100%{opacity:0.2}50%{opacity:1}}
@keyframes nodeActive{0%,100%{opacity:0}50%{opacity:1}}

/* === BOTTOM BAR === */
.bottombar{display:flex;align-items:center;justify-content:space-between;padding:6px 20px;background:rgba(0,0,0,0.9);border-top:1px solid rgba(0,255,136,0.08);font-size:9px;color:rgba(255,255,255,0.2)}
.bb-left{display:flex;align-items:center;gap:12px}
.refresh-indicator{display:flex;align-items:center;gap:4px}
.refresh-dot{width:4px;height:4px;border-radius:50%;background:var(--g1);animation:pulse 1.5s infinite}

/* === APP ROW === */
.app-row{display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.03)}
.app-row:last-child{border:none}
.ar-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.ar-on{background:var(--g1);box-shadow:0 0 8px var(--g1);animation:pulse 2s infinite}
.ar-off{background:var(--r1);animation:pbFlash 1s infinite}
.ar-name{font-size:11px;font-weight:600;flex:1}
.ar-ms{font-size:10px;text-align:right}

/* === ORDERS === */
.order-item{display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.03);font-size:11px}
.order-item:last-child{border:none}
.order-label{color:rgba(255,255,255,0.4);flex:1}
.order-val{font-weight:600}

/* === HEARTBEAT CHART === */
.hb-chart{height:40px;display:flex;align-items:flex-end;gap:2px;padding:8px 0}
.hb-bar{flex:1;background:var(--g1);border-radius:1px 1px 0 0;transition:height 0.5s;min-height:2px;opacity:0.6;animation:hbGrow 0.5s ease-out both}
@keyframes hbGrow{from{height:0!important}to{}}
</style>
</head>
<body>
<canvas id="matrix"></canvas>
<div class="grid-overlay"></div>
<div class="hud-border">
  <div class="hud-corner tl"></div><div class="hud-corner tr"></div>
  <div class="hud-corner bl"></div><div class="hud-corner br"></div>
</div>
<div class="scanline"></div>

<div class="app">

<!-- TOP BAR -->
<div class="topbar">
  <div class="tb-left">
    <svg class="logo-svg" viewBox="0 0 36 36" fill="none">
      <polygon points="18,2 33,10 33,26 18,34 3,26 3,10" fill="none" stroke="url(#lgr)" stroke-width="1.5"/>
      <polygon points="18,7 28,12 28,24 18,29 8,24 8,12" fill="rgba(0,255,136,0.05)" stroke="url(#lgr)" stroke-width="0.8"/>
      <text x="18" y="21" text-anchor="middle" font-family="Orbitron" font-size="9" font-weight="900" fill="url(#lgr)">SB</text>
      <defs><linearGradient id="lgr" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#00ff88"/><stop offset="100%" stop-color="#00aaff"/></linearGradient></defs>
    </svg>
    <div>
      <div class="brand">SEOBAIKE<sub>WAR ROOM</sub></div>
    </div>
  </div>
  <div class="tb-right">
    <div class="commander-name">指揮官 許竣翔</div>
    <div class="live-indicator"><div class="live-dot"></div><span class="live-text">LIVE</span></div>
    <span class="clock" id="clock">--</span>
  </div>
</div>

<!-- COMMANDER HEADER -->
<div style="display:flex;align-items:center;justify-content:center;gap:24px;padding:14px 20px;background:linear-gradient(180deg,rgba(0,255,136,0.04),transparent);border-bottom:1px solid rgba(0,255,136,0.1);position:relative">
  <div style="position:absolute;left:0;right:0;bottom:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,170,0,0.3),transparent)"></div>
  <div style="text-align:center">
    <div style="font-family:Orbitron;font-size:22px;font-weight:900;letter-spacing:6px;color:var(--gold);text-shadow:0 0 30px rgba(255,170,0,0.4);animation:cmdGlow 3s ease-in-out infinite">指揮官：許竣翔</div>
    <div style="font-size:11px;color:rgba(255,255,255,0.4);margin-top:4px;letter-spacing:2px">CEO, 小路光有限公司 · 統編 60475510 · SEOBAIKE AI Platform</div>
    <div style="margin-top:6px;display:inline-block;padding:3px 14px;border:1px solid rgba(255,170,0,0.3);border-radius:20px;font-size:10px;color:var(--gold);letter-spacing:2px;animation:patentFlash 3s ease-in-out infinite">Patent 115100981 — 世界定義約束法用於AI推理 — CaaS</div>
  </div>
</div>
<style>@keyframes cmdGlow{0%,100%{text-shadow:0 0 20px rgba(255,170,0,0.3)}50%{text-shadow:0 0 40px rgba(255,170,0,0.6),0 0 80px rgba(255,170,0,0.2)}}</style>

<!-- STATUS STRIP -->
<div class="status-strip">
  <div class="patent-badge">PATENT 115100981</div>
  <div style="flex:1;overflow:hidden"><div class="ss-scroll" id="statusStrip"></div></div>
</div>

<!-- MAIN -->
<div class="content" id="content">
  <div style="grid-column:1/-1;text-align:center;padding:60px;color:rgba(255,255,255,0.2);font-family:Orbitron;letter-spacing:4px;font-size:12px">INITIALIZING WAR ROOM...</div>
</div>

<!-- BOTTOM BAR -->
<div class="bottombar">
  <div class="bb-left">
    <span>SEOBAIKE AI Platform</span>
    <span>Patent 115100981</span>
    <span>CaaS L1-L4</span>
  </div>
  <div class="refresh-indicator">
    <div class="refresh-dot"></div>
    <span id="refreshTimer">AUTO 15s</span>
  </div>
</div>

</div>

<script>
const API='https://grok-takeover-app.azurewebsites.net/api/commander';
let D=null,retryN=0;

// === MATRIX RAIN ===
const mc=document.getElementById('matrix'),mx=mc.getContext('2d');
function resizeMC(){mc.width=window.innerWidth;mc.height=window.innerHeight}
window.addEventListener('resize',resizeMC);resizeMC();
const cols=Math.floor(mc.width/14),drops=Array(cols).fill(1);
const chars='SEOBAIKE01アイウエオカキクケコ物理AI約束法'.split('');
function drawMatrix(){
  mx.fillStyle='rgba(0,0,0,0.05)';mx.fillRect(0,0,mc.width,mc.height);
  mx.font='12px JetBrains Mono';
  for(let i=0;i<drops.length;i++){
    mx.fillStyle=`hsl(${140+Math.random()*40},100%,${50+Math.random()*30}%)`;
    mx.fillText(chars[Math.floor(Math.random()*chars.length)],i*14,drops[i]*14);
    if(drops[i]*14>mc.height&&Math.random()>0.975)drops[i]=0;
    drops[i]++;
  }
}
setInterval(drawMatrix,50);

// === CLOCK ===
function updateClock(){
  document.getElementById('clock').textContent=new Date().toLocaleString('zh-TW',{timeZone:'Asia/Taipei',hour12:false,month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit'});
}
setInterval(updateClock,1000);updateClock();

// === DATA ===
async function load(){
  try{
    const ac=new AbortController();
    const t=setTimeout(()=>ac.abort(),12000);
    const r=await fetch(API,{signal:ac.signal});clearTimeout(t);
    D=await r.json();render();buildStrip();retryN=0;
  }catch(e){retryN++;if(retryN<=3)setTimeout(load,2000);else setTimeout(load,5000);}
}

function msClass(ms){return ms<500?'ms-fast':ms<2000?'ms-med':'ms-slow'}
function msColor(ms){return ms<500?'var(--g1)':ms<2000?'var(--gold)':'var(--r1)'}

// === STATUS STRIP ===
function buildStrip(){
  if(!D)return;
  const items=[];
  const on=D.soldiers?D.soldiers.filter(s=>s.status==='ONLINE').length:0;
  items.push({c:'ss-ok',t:`MODELS ${on}/10`});
  items.push({c:'ss-ok',t:`APPS ${D.progress_detail?.azure_apps||'--'}`});
  items.push({c:'ss-ok',t:`SUPABASE ${D.progress_detail?.supabase||'--'}`});
  items.push({c:'ss-ok',t:`CLOUDFLARE ONLINE`});
  items.push({c:'ss-ok',t:`TELEGRAM ${D.telegram||'--'}`});
  items.push({c:'ss-ok',t:`CaaS L1-L4 ACTIVE`});
  (D.soldiers||[]).forEach(s=>{
    items.push({c:s.status==='ONLINE'?'ss-ok':'ss-err',t:`${s.slot} ${s.status} ${s.response_ms>0?s.response_ms+'ms':''}`});
  });
  const all=[...items,...items];
  document.getElementById('statusStrip').innerHTML=all.map(i=>`<span class="ss-item ${i.c}"><span class="ss-dot"></span>${i.t}</span>`).join('');
}

// === RENDER ===
function render(){
  if(!D)return;
  const on=D.soldiers?D.soldiers.filter(s=>s.status==='ONLINE').length:0;
  const apps=D.azure_apps?D.azure_apps.filter(a=>a.status==='RUNNING').length:0;
  const sb=D.progress_detail?.supabase==='connected';
  const slackers=Array.isArray(D.slackers)?D.slackers:[];
  const logs=D.audit_trail||[];

  let h='';

  // === LEFT COLUMN ===
  h+=`<div style="display:flex;flex-direction:column;gap:12px">`;

  // Radar
  h+=`<div class="panel"><div class="panel-head"><span class="panel-title">RADAR</span><span class="panel-badge pb-g">${on}/10</span></div>
  <div class="panel-body"><div class="radar-container">
    <svg class="radar-svg" viewBox="0 0 200 200">
      <circle cx="100" cy="100" r="90" fill="none" stroke="rgba(0,255,136,0.04)" stroke-width="0.5"/>
      <circle cx="100" cy="100" r="70" fill="none" stroke="rgba(0,255,136,0.04)" stroke-width="0.5"/>
      <circle cx="100" cy="100" r="50" fill="none" stroke="rgba(0,255,136,0.04)" stroke-width="0.5"/>
      <circle cx="100" cy="100" r="30" fill="none" stroke="rgba(0,255,136,0.04)" stroke-width="0.5"/>
      <line x1="100" y1="10" x2="100" y2="190" stroke="rgba(0,255,136,0.03)"/>
      <line x1="10" y1="100" x2="190" y2="100" stroke="rgba(0,255,136,0.03)"/>
      <path d="M100,100 L100,10 A90,90,0,0,1,163,37 Z" fill="rgba(0,255,136,0.06)" class="radar-sweep"/>
      ${(D.soldiers||[]).map((s,i)=>{
        const a=(i/10)*Math.PI*2-Math.PI/2;
        const r2=s.status==='ONLINE'?50+Math.random()*30:20+Math.random()*10;
        const x=100+Math.cos(a)*r2,y=100+Math.sin(a)*r2;
        return `<circle cx="${x}" cy="${y}" fill="${s.status==='ONLINE'?'var(--g1)':'var(--r1)'}" class="radar-blip" style="animation-delay:${i*0.3}s"><title>${s.slot}</title></circle>`;
      }).join('')}
    </svg>
  </div></div></div>`;

  // Metrics
  h+=`<div class="panel"><div class="panel-head"><span class="panel-title">SYSTEMS</span><span class="panel-badge pb-g">${D.overall_progress}</span></div>
  <div class="panel-body">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
      <div class="metric"><div class="metric-val" style="color:${on>=10?'var(--g1)':'var(--r1)'}">${on}</div><div class="metric-label">MODELS</div><div class="metric-bar"><div class="metric-fill" style="width:${on*10}%;background:${on>=10?'var(--g1)':'var(--r1)'}"></div></div></div>
      <div class="metric"><div class="metric-val" style="color:${apps>=3?'var(--g1)':'var(--r1)'}">${apps}</div><div class="metric-label">AZURE</div><div class="metric-bar"><div class="metric-fill" style="width:${apps/3*100}%;background:${apps>=3?'var(--g1)':'var(--r1)'}"></div></div></div>
      <div class="metric"><div class="metric-val" style="color:${sb?'var(--g1)':'var(--r1)';font-size:18px}">${sb?'OK':'ERR'}</div><div class="metric-label">SUPABASE</div><div class="metric-bar"><div class="metric-fill" style="width:${sb?100:0}%;background:var(--g1)"></div></div></div>
      <div class="metric"><div class="metric-val" style="color:var(--g1);font-size:18px">OK</div><div class="metric-label">TELEGRAM</div><div class="metric-bar"><div class="metric-fill" style="width:100%;background:var(--cyan)"></div></div></div>
    </div>
  </div></div>`;

  // Physical AI
  h+=`<div class="panel"><div class="panel-head"><span class="panel-title">PHYSICAL AI</span><span class="panel-badge pb-b">L1-L4</span></div>
  <div class="panel-body">
    <div style="font-size:10px;color:rgba(255,255,255,0.3);margin-bottom:6px">世界定義約束法 CaaS</div>
    <div class="pai-flow">
      <span class="pai-node pai-l1">L1 物理</span><span class="pai-arrow">▸</span>
      <span class="pai-node pai-l2">L2 商業</span><span class="pai-arrow">▸</span>
      <span class="pai-node pai-l3">L3 安全</span><span class="pai-arrow">▸</span>
      <span class="pai-node pai-l4">L4 指揮</span>
    </div>
    <div style="margin-top:8px;font-size:9px;color:rgba(255,255,255,0.2)">自主巡邏 → 自動修復 → 自動報告</div>
  </div></div>`;

  h+=`</div>`;

  // === CENTER COLUMN ===
  h+=`<div style="display:flex;flex-direction:column;gap:12px;overflow-y:auto">`;

  // AI Soldiers
  h+=`<div class="panel"><div class="panel-head"><span class="panel-title">AI SOLDIERS</span><span class="panel-badge ${on>=10?'pb-g':'pb-r'}">${on}/10 ONLINE</span></div>
  <div class="panel-body">`;
  (D.soldiers||[]).forEach(s=>{
    const alive=s.status==='ONLINE';
    h+=`<div class="soldier-row">
      <div class="sr-status ${alive?'sr-on':'sr-off'}"></div>
      <span class="sr-name">${s.slot}</span>
      <span style="font-size:9px;color:rgba(255,255,255,0.2)">${s.size}</span>
      <span class="sr-ms ${msClass(s.response_ms)}">${s.response_ms>0?s.response_ms+'ms':'--'}</span>
      <span class="sr-cost">${s.cost}</span>
    </div>`;
  });
  h+=`</div></div>`;

  // Azure Apps
  h+=`<div class="panel"><div class="panel-head"><span class="panel-title">AZURE APPS</span><span class="panel-badge ${apps>=3?'pb-g':'pb-r'}">${apps}/3</span></div>
  <div class="panel-body">`;
  (D.azure_apps||[]).forEach(a=>{
    const alive=a.status==='RUNNING';
    h+=`<div class="app-row">
      <div class="ar-dot ${alive?'ar-on':'ar-off'}"></div>
      <span class="ar-name">${a.name}</span>
      <span class="ar-ms" style="color:${msColor(a.response_ms)}">${a.response_ms>0?a.response_ms+'ms':'--'}</span>
    </div>`;
  });
  h+=`</div></div>`;

  // Orders
  h+=`<div class="panel"><div class="panel-head"><span class="panel-title">COMMANDER ORDERS</span><span class="panel-badge ${slackers.length?'pb-r':'pb-g'}">${slackers.length?'ACTION':'CLEAR'}</span></div>
  <div class="panel-body">
    <div class="order-item"><span class="order-label">Dead Models</span><span class="order-val" style="color:${slackers.length?'var(--r1)':'var(--g1)'}">${D.orders?.dead_models||'--'}</span></div>
    <div class="order-item"><span class="order-label">Slow Response</span><span class="order-val" style="color:var(--g1)">${D.orders?.slow_response||'--'}</span></div>
    <div class="order-item"><span class="order-label">Cost Waste</span><span class="order-val" style="color:var(--g1)">${D.orders?.cost_waste||'--'}</span></div>
    <div class="order-item"><span class="order-label">Slackers</span><span class="order-val" style="color:${slackers.length?'var(--r1)':'var(--g1)'}">${slackers.length?slackers.join(', '):'NONE'}</span></div>
    <div class="order-item"><span class="order-label">Last Patrol</span><span class="order-val" style="color:var(--b1);font-size:10px">${D.last_patrol?new Date(D.last_patrol).toLocaleTimeString('zh-TW',{timeZone:'Asia/Taipei',hour12:false}):'--'}</span></div>
  </div></div>`;

  h+=`</div>`;

  // === RIGHT COLUMN ===
  h+=`<div style="display:flex;flex-direction:column;gap:12px">`;

  // Heartbeat Chart
  h+=`<div class="panel"><div class="panel-head"><span class="panel-title">HEARTBEAT</span><span class="panel-badge pb-g">LIVE</span></div>
  <div class="panel-body"><div class="hb-chart">`;
  const hbs=D.supabase_heartbeats||[];
  for(let i=0;i<Math.min(hbs.length,20);i++){
    const ok=hbs[i].status==='healthy';
    h+=`<div class="hb-bar" style="height:${ok?60+Math.random()*40:10}%;background:${ok?'var(--g1)':'var(--r1)'};animation-delay:${i*0.03}s"></div>`;
  }
  if(hbs.length===0){for(let i=0;i<20;i++)h+=`<div class="hb-bar" style="height:${30+Math.random()*70}%;opacity:0.2;animation-delay:${i*0.03}s"></div>`}
  h+=`</div>
  <div style="font-size:9px;color:rgba(255,255,255,0.2);margin-top:4px">${hbs.length?hbs.length+' records':'waiting...'}</div>
  </div></div>`;

  // Audit Trail
  h+=`<div class="panel" style="flex:1;overflow:hidden"><div class="panel-head"><span class="panel-title">AUDIT LOG</span><span class="panel-badge pb-b">${logs.length}</span></div>
  <div class="panel-body log-feed">`;
  if(!logs.length)h+=`<div style="color:rgba(255,255,255,0.15);font-size:10px;padding:10px 0">Next patrol in 5 min</div>`;
  logs.slice(0,15).forEach((l,i)=>{
    const t=l.created_at?new Date(l.created_at).toLocaleTimeString('zh-TW',{timeZone:'Asia/Taipei',hour12:false}):'--';
    const cls=l.log_type==='patrol'?'lt-patrol':l.log_type==='auto_heal'?'lt-heal':l.log_type==='commander_access'?'lt-access':'lt-alert';
    h+=`<div class="log-entry" style="animation-delay:${i*0.05}s">
      <span class="log-time">${t}</span><span class="log-type ${cls}">${l.log_type}</span><span class="log-msg">${l.action||''}</span>
    </div>`;
  });
  h+=`</div></div>`;

  // Supabase heartbeats list
  h+=`<div class="panel"><div class="panel-head"><span class="panel-title">COMPONENTS</span><span class="panel-badge pb-g">${hbs.length}</span></div>
  <div class="panel-body" style="max-height:120px;overflow-y:auto">`;
  hbs.slice(0,8).forEach(hb=>{
    const ok=hb.status==='healthy';
    h+=`<div class="soldier-row">
      <div class="sr-status ${ok?'sr-on':'sr-off'}"></div>
      <span class="sr-name">${hb.component}</span>
      <span style="font-size:9px;color:${ok?'var(--g1)':'var(--r1)'}">${hb.status}</span>
    </div>`;
  });
  h+=`</div></div>`;

  h+=`</div>`;

  document.getElementById('content').innerHTML=h;
}

load();
setInterval(load,15000);
setInterval(()=>{location.reload()},300000);
</script>
</body>
</html>
