<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SEOBAIKE — 協作機器人控制中心</title>
<meta name="description" content="SEOBAIKE AI OS 14 平台協作機器人，一鍵連入全球通訊平台">
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:#0a0a1a;color:#eee;min-height:100vh}
a{color:#e8850c;text-decoration:none}a:hover{text-decoration:underline}

/* NAV */
.nav{background:#111;border-bottom:1px solid #222;padding:0 30px;display:flex;align-items:center;height:56px;gap:24px}
.nav-logo{font-size:18px;font-weight:700;color:#e8850c}
.nav-links{display:flex;gap:16px;margin-left:auto}
.nav-links a{color:#999;font-size:13px;padding:6px 10px;border-radius:6px;transition:.2s}
.nav-links a:hover,.nav-links a.active{color:#fff;background:#1a1a2e;text-decoration:none}

/* HERO */
.hero{background:linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0a0a1a 100%);padding:48px 30px 32px;text-align:center;border-bottom:1px solid #222}
.hero h1{font-size:36px;background:linear-gradient(135deg,#e8850c,#cc785c,#76b900);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:8px}
.hero p{color:#888;font-size:15px;max-width:600px;margin:0 auto}

/* STATS */
.stats-bar{display:flex;justify-content:center;gap:40px;padding:24px 30px;border-bottom:1px solid #1a1a2e}
.stat-item{text-align:center}
.stat-num{font-size:42px;font-weight:800;color:#76b900;line-height:1}
.stat-num.warn{color:#e8850c}
.stat-num.off{color:#555}
.stat-lbl{font-size:12px;color:#888;margin-top:4px}

/* GRID */
.bot-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px;padding:24px 30px}

.bot-card{background:#16213e;border:1px solid #222;border-radius:16px;overflow:hidden;transition:all .3s}
.bot-card:hover{border-color:#e8850c;transform:translateY(-2px);box-shadow:0 8px 30px rgba(232,133,12,.15)}
.bot-card.online{border-left:4px solid #76b900}
.bot-card.offline{border-left:4px solid #333}

.bot-header{display:flex;align-items:center;gap:12px;padding:16px 20px;background:#1a1a2e}
.bot-icon{font-size:32px}
.bot-name{font-size:18px;font-weight:700}
.bot-status{margin-left:auto;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:700}
.bot-status.on{background:#76b900;color:#000}
.bot-status.off{background:#333;color:#888}
.bot-status.loading{background:#e8850c;color:#000;animation:blink 1s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.5}}

.bot-body{padding:16px 20px}
.bot-webhook{background:#0d1117;border:1px solid #222;border-radius:8px;padding:8px 12px;font-family:monospace;font-size:11px;color:#76b900;word-break:break-all;margin-bottom:12px}
.bot-features{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px}
.bot-feat{background:#0d1117;border:1px solid #222;padding:3px 10px;border-radius:12px;font-size:11px;color:#cc785c}
.bot-tokens{font-size:11px;color:#666;margin-bottom:12px}
.bot-tokens code{color:#e8850c;background:#0d1117;padding:1px 4px;border-radius:3px}

.bot-actions{display:flex;gap:8px}
.btn{padding:8px 16px;border-radius:8px;border:none;font-size:12px;font-weight:600;cursor:pointer;transition:.2s}
.btn-primary{background:#e8850c;color:#fff}.btn-primary:hover{background:#ff9f30}
.btn-test{background:#16213e;color:#76b900;border:1px solid #333}.btn-test:hover{background:#1a1a2e}
.btn-setup{background:#76b900;color:#000}.btn-setup:hover{background:#8ed100}
.btn:disabled{opacity:.4;cursor:not-allowed}

/* LOG */
.log-section{padding:24px 30px}
.log-section h3{font-size:16px;color:#e8850c;margin-bottom:12px}
.log-box{background:#0d1117;border:1px solid #222;border-radius:12px;padding:16px;max-height:300px;overflow-y:auto;font-family:monospace;font-size:12px;line-height:1.8}
.log-ok{color:#76b900}.log-err{color:#ff6b6b}.log-info{color:#e8850c}.log-ts{color:#555}

/* SETUP */
.setup-section{padding:24px 30px;border-top:1px solid #1a1a2e}
.setup-section h3{font-size:16px;color:#cc785c;margin-bottom:16px}
.setup-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(400px,1fr));gap:12px}
.setup-step{background:#16213e;border:1px solid #222;border-radius:12px;padding:16px 20px}
.setup-step h4{color:#e8850c;font-size:14px;margin-bottom:8px}
.setup-step p{color:#888;font-size:12px;line-height:1.6}
.setup-step code{color:#76b900;background:#0d1117;padding:1px 6px;border-radius:3px;font-size:11px}

.footer{text-align:center;padding:24px;color:#444;font-size:11px;border-top:1px solid #111}
@media(max-width:768px){
  .bot-grid{grid-template-columns:1fr}
  .stats-bar{flex-wrap:wrap;gap:20px}
  .nav-links{gap:8px}
  .setup-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<nav class="nav">
  <div class="nav-logo">SEOBAIKE</div>
  <div class="nav-links">
    <a href="/">首頁</a>
    <a href="/features">功能</a>
    <a href="/marketplace">市集</a>
    <a href="/bots" class="active">機器人</a>
    <a href="/pricing">方案</a>
    <a href="/docs">文件</a>
    <a href="/dashboard">控制台</a>
    <a href="/login">登入</a>
  </div>
</nav>

<div class="hero">
  <h1>協作機器人控制中心</h1>
  <p>14 個平台、14 個遙控器、一套 AI OS。連入任何通訊平台，SEOBAIKE 都在你身邊。</p>
</div>

<div class="stats-bar">
  <div class="stat-item"><div class="stat-num" id="s-total">--</div><div class="stat-lbl">平台總數</div></div>
  <div class="stat-item"><div class="stat-num" id="s-online">--</div><div class="stat-lbl">已上線</div></div>
  <div class="stat-item"><div class="stat-num warn" id="s-offline">--</div><div class="stat-lbl">等待連入</div></div>
  <div class="stat-item"><div class="stat-num off" id="s-features">--</div><div class="stat-lbl">功能總數</div></div>
</div>

<div class="bot-grid" id="botGrid">
  <div style="text-align:center;padding:40px;color:#555;">載入中...</div>
</div>

<div class="log-section">
  <h3>即時操作記錄</h3>
  <div class="log-box" id="logBox">
    <div class="log-info">等待操作...</div>
  </div>
</div>

<div class="setup-section">
  <h3>快速上線指南</h3>
  <div class="setup-grid">
    <div class="setup-step">
      <h4>Step 1：取得 Bot Token</h4>
      <p>到各平台開發者後台建立機器人，取得 API Token / Secret。<br>例如 Telegram 到 <code>@BotFather</code> 取得 token，LINE 到 LINE Developers 建立 Messaging API channel。</p>
    </div>
    <div class="setup-step">
      <h4>Step 2：設定 Workers Secret</h4>
      <p>在命令列中執行：<br><code>wrangler secret put TELEGRAM_BOT_TOKEN</code><br>輸入 token 值即可。每個平台有對應的 secret key。</p>
    </div>
    <div class="setup-step">
      <h4>Step 3：設定 Webhook</h4>
      <p>將平台的 Webhook URL 指向：<br><code>https://aiforseo.vip/api/webhook/{platform}</code><br>Telegram 可用「一鍵設定」按鈕自動完成。</p>
    </div>
    <div class="setup-step">
      <h4>Step 4：測試 & 上線</h4>
      <p>點擊「測試」按鈕發送測試訊息，確認機器人正常運作。<br>所有機器人共享同一個 AI 大腦 + L1-L4 行業約束 + 審批系統。</p>
    </div>
  </div>
</div>

<footer class="footer">
  SEOBAIKE AI OS — 專利 TW-115100981 — 小路光有限公司 — 14 平台協作機器人架構
</footer>

<script src="/seobaike-config.js"></script>
<script>
const API_BASE = ''
const LOG = document.getElementById('logBox')

function addLog(text, cls) {
  const ts = new Date().toLocaleTimeString('zh-TW')
  const d = document.createElement('div')
  d.innerHTML = '<span class="log-ts">[' + ts + ']</span> <span class="' + cls + '">' + text + '</span>'
  LOG.prepend(d)
  if (LOG.children.length > 50) LOG.lastChild.remove()
}

function renderBots(data) {
  const grid = document.getElementById('botGrid')
  document.getElementById('s-total').textContent = data.total_bots
  document.getElementById('s-online').textContent = data.online_bots
  document.getElementById('s-offline').textContent = data.offline_bots
  const allFeats = data.bots.reduce((sum, b) => sum + b.features.length, 0)
  document.getElementById('s-features').textContent = allFeats

  grid.innerHTML = data.bots.map(bot => {
    const isOn = bot.status === 'online'
    const tokenList = bot.token_keys.map(k => '<code>' + k + '</code>').join(', ')
    const featHtml = bot.features.map(f => '<span class="bot-feat">' + f + '</span>').join('')

    let actionsHtml = ''
    if (bot.id === 'telegram' && isOn) {
      actionsHtml = '<button class="btn btn-setup" onclick="setupTelegram()">一鍵設定 Webhook</button> <button class="btn btn-test" onclick="testTelegram()">測試</button> <button class="btn btn-primary" onclick="getTelegramInfo()">查看狀態</button>'
    } else if (isOn) {
      actionsHtml = '<button class="btn btn-test" onclick="testWebhook(\'' + bot.id + '\')">測試 Webhook</button>'
    } else {
      actionsHtml = '<a href="' + bot.setup_url + '" target="_blank" class="btn btn-primary">前往設定</a>'
    }

    return '<div class="bot-card ' + (isOn ? 'online' : 'offline') + '">' +
      '<div class="bot-header">' +
        '<span class="bot-icon">' + bot.icon + '</span>' +
        '<span class="bot-name">' + bot.name + '</span>' +
        '<span class="bot-status ' + (isOn ? 'on' : 'off') + '">' + (isOn ? 'ONLINE' : 'WAITING') + '</span>' +
      '</div>' +
      '<div class="bot-body">' +
        '<div class="bot-webhook">' + bot.webhook + '</div>' +
        '<div class="bot-features">' + featHtml + '</div>' +
        (tokenList ? '<div class="bot-tokens">需要 Secrets: ' + tokenList + '</div>' : '') +
        '<div class="bot-actions">' + actionsHtml + '</div>' +
      '</div>' +
    '</div>'
  }).join('')
}

async function loadBots() {
  try {
    const res = await fetch(API_BASE + '/api/bots/status')
    const data = await res.json()
    renderBots(data)
    addLog('載入 ' + data.total_bots + ' 個協作機器人，' + data.online_bots + ' 個已上線', 'log-ok')
  } catch(e) {
    addLog('載入失敗: ' + e.message, 'log-err')
  }
}

async function setupTelegram() {
  addLog('正在設定 Telegram Webhook...', 'log-info')
  try {
    const res = await fetch(API_BASE + '/api/bots/telegram/setup', { method: 'POST' })
    const data = await res.json()
    if (data.success) {
      addLog('Telegram Webhook 設定成功! URL: ' + data.webhook_url, 'log-ok')
    } else {
      addLog('設定失敗: ' + JSON.stringify(data), 'log-err')
    }
  } catch(e) {
    addLog('設定失敗: ' + e.message, 'log-err')
  }
}

async function testTelegram() {
  addLog('正在發送 Telegram 測試訊息...', 'log-info')
  try {
    const res = await fetch(API_BASE + '/api/bots/telegram/test', {
      method: 'POST', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ chat_id: '5372713163' })
    })
    const data = await res.json()
    if (data.success) {
      addLog('Telegram 測試訊息已發送!', 'log-ok')
    } else {
      addLog('測試失敗: ' + JSON.stringify(data), 'log-err')
    }
  } catch(e) {
    addLog('測試失敗: ' + e.message, 'log-err')
  }
}

async function getTelegramInfo() {
  addLog('正在查詢 Telegram Bot 資訊...', 'log-info')
  try {
    const res = await fetch(API_BASE + '/api/bots/telegram/info')
    const data = await res.json()
    const bot = data.bot?.result || {}
    const wh = data.webhook?.result || {}
    addLog('Bot: @' + (bot.username || '?') + ' | Webhook: ' + (wh.url || 'not set') + ' | Pending: ' + (wh.pending_update_count || 0), 'log-ok')
  } catch(e) {
    addLog('查詢失敗: ' + e.message, 'log-err')
  }
}

async function testWebhook(platform) {
  addLog('測試 ' + platform + ' webhook...', 'log-info')
  try {
    const res = await fetch(API_BASE + '/api/webhook/' + platform, {
      method: 'POST', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ test: true })
    })
    const data = await res.json()
    addLog(platform + ' webhook 回應: ' + JSON.stringify(data).substring(0, 100), data.status === 'os_ready' ? 'log-info' : 'log-ok')
  } catch(e) {
    addLog(platform + ' webhook 失敗: ' + e.message, 'log-err')
  }
}

// 頁面瀏覽追蹤
if (window.__SEOBAIKE__) {
  fetch((window.__SEOBAIKE__.supabaseUrl || '') + '/rest/v1/page_views', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'apikey': window.__SEOBAIKE__.anonKey || '', 'Authorization': 'Bearer ' + (window.__SEOBAIKE__.anonKey || ''), 'Prefer': 'return=minimal' },
    body: JSON.stringify({ page: '/bots', referrer: document.referrer || null, user_agent: navigator.userAgent })
  }).catch(() => {})
}

loadBots()
setInterval(loadBots, 30000)
</script>
</body>
</html>
