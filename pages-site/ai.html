<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SEOBAIKE AI è¶…ç´šå¼•æ“ | 8 å¤§èƒ½åŠ› 1000+ æ¨¡å‹</title>
<meta name="description" content="SEOBAIKE AI è¶…ç´šå¼•æ“ â€” å°è©±ã€ç¨‹å¼ç¢¼ã€è¦–è¦ºã€æ¨ç†ã€æœå°‹ã€åµŒå…¥ã€åœ–åƒç”Ÿæˆã€èªéŸ³ï¼Œ8 å¤§èƒ½åŠ› 1000+ AI æ¨¡å‹ï¼Œä¸€å€‹å¹³å°å…¨éƒ¨æå®š">
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:#0a0a1a;color:#eee;min-height:100vh}
a{color:#e8850c;text-decoration:none}a:hover{text-decoration:underline}
.nav{background:#111;border-bottom:1px solid #222;padding:0 30px;display:flex;align-items:center;height:56px;gap:24px}
.nav-logo{font-size:18px;font-weight:700;color:#e8850c}
.nav-links{display:flex;gap:16px;margin-left:auto}
.nav-links a{color:#999;font-size:13px;padding:6px 10px;border-radius:6px;transition:.2s}
.nav-links a:hover,.nav-links a.active{color:#fff;background:#1a1a2e;text-decoration:none}

.hero{background:linear-gradient(135deg,#0a0a1a 0%,#2a1a0e 40%,#1a0a0e 70%,#0a0a1a 100%);padding:48px 30px 32px;text-align:center;border-bottom:1px solid #222;position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at 30% 50%,rgba(232,133,12,.1) 0%,transparent 50%),radial-gradient(circle at 70% 50%,rgba(255,159,48,.08) 0%,transparent 50%);pointer-events:none}
.hero h1{font-size:42px;background:linear-gradient(135deg,#e8850c,#ff9f30,#e8850c);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:8px;position:relative}
.hero p{color:#888;font-size:15px;max-width:700px;margin:0 auto;position:relative}
.hero .count{font-size:72px;font-weight:900;color:#e8850c;margin:16px 0 8px;position:relative}

.stats-row{display:flex;justify-content:center;gap:32px;padding:20px 30px;border-bottom:1px solid #1a1a2e;flex-wrap:wrap}
.stat-box{text-align:center;min-width:120px}
.stat-box .n{font-size:32px;font-weight:800;color:#e8850c}
.stat-box .l{font-size:11px;color:#666;margin-top:2px}

.capability-bar{display:flex;gap:10px;padding:12px 30px;overflow-x:auto;border-bottom:1px solid #1a1a2e;flex-wrap:wrap}
.cap-chip{background:#16213e;border:1px solid #222;border-radius:10px;padding:8px 14px;min-width:120px;font-size:12px;display:flex;align-items:center;gap:8px;cursor:pointer;transition:.2s}
.cap-chip:hover{border-color:#e8850c}
.cap-chip .cap-icon{font-size:16px}
.cap-chip .cap-name{color:#eee;font-weight:600}
.cap-chip .cap-count{color:#888;margin-left:auto;font-size:11px}

.controls{display:flex;gap:12px;padding:20px 30px;flex-wrap:wrap;align-items:center}
.search-box{flex:1;min-width:200px;background:#16213e;border:1px solid #333;border-radius:10px;padding:10px 16px;color:#eee;font-size:14px;outline:none}
.search-box:focus{border-color:#e8850c}
.filter-btn{padding:8px 16px;border-radius:20px;border:1px solid #333;background:#16213e;color:#888;font-size:12px;cursor:pointer;transition:.2s}
.filter-btn:hover,.filter-btn.active{background:#e8850c;color:#000;border-color:#e8850c}

.model-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:14px;padding:20px 30px}
.model-card{background:#16213e;border:1px solid #222;border-radius:14px;padding:18px 20px;transition:all .3s;cursor:pointer;position:relative;overflow:hidden}
.model-card:hover{border-color:#e8850c;transform:translateY(-2px);box-shadow:0 8px 30px rgba(232,133,12,.12)}
.model-card.active{border-color:#e8850c;box-shadow:0 0 20px rgba(232,133,12,.2)}
.model-cap-icon{font-size:22px;margin-bottom:6px}
.model-tier{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px;display:flex;align-items:center;gap:6px}
.model-tier .tier-label{padding:2px 8px;border-radius:6px;font-size:10px}
.tier-enterprise{background:#2a1a0e;color:#e8850c;border:1px solid #4a2a0a}
.tier-opensource{background:#1a2e1a;color:#76b900;border:1px solid #2a4a2a}
.tier-highspeed{background:#0a2e2e;color:#4ecdc4;border:1px solid #0a4a4a}
.model-name{font-size:16px;font-weight:700;color:#fff;margin-bottom:6px}
.model-speed{display:flex;align-items:center;gap:6px;margin-bottom:10px}
.speed-bar{height:4px;border-radius:2px;background:#222;flex:1;max-width:80px;overflow:hidden}
.speed-fill{height:100%;border-radius:2px;background:#e8850c}
.speed-label{font-size:10px;color:#666}
.model-tags{display:flex;flex-wrap:wrap;gap:4px}
.tag{padding:2px 8px;border-radius:10px;font-size:10px;font-weight:600}
.tag-code{background:#1a2e1a;color:#76b900;border:1px solid #2a4a2a}
.tag-chat{background:#2e1a0a;color:#e8850c;border:1px solid #4a2a0a}
.tag-vision{background:#1a1a2e;color:#cc785c;border:1px solid #2a2a4a}
.tag-embed{background:#0a2e2e;color:#4ecdc4;border:1px solid #0a4a4a}
.tag-reason{background:#2e0a2e;color:#ff6b9d;border:1px solid #4a0a4a}
.tag-large{background:#2e2e0a;color:#ffd93d;border:1px solid #4a4a0a}
.tag-search{background:#2e0a1e;color:#ff6b9d;border:1px solid #4a0a3a}
.tag-image{background:#1a2e2e;color:#40c9ff;border:1px solid #0a4a5a}
.tag-audio{background:#2e2a0a;color:#ffc93d;border:1px solid #4a4a0a}

.chat-panel{position:fixed;bottom:0;right:0;width:420px;max-height:70vh;background:#111;border:1px solid #333;border-radius:16px 16px 0 0;display:none;flex-direction:column;z-index:100;box-shadow:0 -8px 40px rgba(0,0,0,.5)}
.chat-panel.open{display:flex}
.chat-header{padding:14px 20px;background:#1a1a2e;border-radius:16px 16px 0 0;display:flex;align-items:center;gap:10px;border-bottom:1px solid #222}
.chat-header h3{font-size:14px;color:#e8850c;flex:1}
.chat-close{background:none;border:none;color:#888;font-size:20px;cursor:pointer}
.chat-messages{flex:1;overflow-y:auto;padding:16px;min-height:200px;max-height:400px}
.chat-msg{margin-bottom:12px;padding:10px 14px;border-radius:12px;font-size:13px;line-height:1.6;max-width:90%}
.chat-msg.user{background:#2a1a0e;color:#e8850c;margin-left:auto;border-bottom-right-radius:4px}
.chat-msg.bot{background:#1a2e1a;color:#ddd;border-bottom-left-radius:4px}
.chat-msg .model-label{font-size:10px;color:#e8850c;margin-bottom:4px;font-weight:700}
.chat-input-row{display:flex;padding:12px;gap:8px;border-top:1px solid #222}
.chat-input{flex:1;background:#16213e;border:1px solid #333;border-radius:10px;padding:10px 14px;color:#eee;font-size:13px;outline:none}
.chat-input:focus{border-color:#e8850c}
.chat-send{background:#e8850c;color:#000;border:none;border-radius:10px;padding:10px 20px;font-weight:700;cursor:pointer;font-size:13px}
.chat-send:hover{background:#ff9f30}
.chat-send:disabled{opacity:.4;cursor:not-allowed}

.footer{text-align:center;padding:24px;color:#444;font-size:11px;border-top:1px solid #111;margin-top:20px}
.loading{text-align:center;padding:40px;color:#555}
@media(max-width:768px){.model-grid{grid-template-columns:1fr}.chat-panel{width:100%;right:0;left:0}.stats-row{gap:16px}.capability-bar{gap:6px}}
</style>
</head>
<body>

<nav class="nav">
  <div class="nav-logo">SEOBAIKE</div>
  <div class="nav-links">
    <a href="/">é¦–é </a>
    <a href="/features">åŠŸèƒ½</a>
    <a href="/marketplace">å¸‚é›†</a>
    <a href="/ai" class="active">AI å¼•æ“</a>
    <a href="/pricing">æ–¹æ¡ˆ</a>
    <a href="/docs">æ–‡ä»¶</a>
    <a href="/login">ç™»å…¥</a>
  </div>
</nav>

<div class="hero">
  <h1>SEOBAIKE AI è¶…ç´šå¼•æ“</h1>
  <div class="count" id="totalCount">--</div>
  <p>å€‹ AI æ¨¡å‹ â€” 8 å¤§èƒ½åŠ›é¡åˆ¥ã€‚å°è©±ã€ç¨‹å¼ç¢¼ã€è¦–è¦ºã€æ¨ç†ã€æœå°‹ã€åµŒå…¥ã€åœ–åƒç”Ÿæˆã€èªéŸ³ï¼Œä¸€å€‹å¹³å°å…¨éƒ¨æå®šã€‚é»ä¸€ä¸‹å°±èƒ½å°è©±ã€‚</p>
</div>

<div class="capability-bar" id="capabilityBar"></div>

<div class="stats-row" id="statsRow">
  <div class="stat-box"><div class="n" id="s-total">--</div><div class="l">æ¨¡å‹ç¸½æ•¸</div></div>
  <div class="stat-box"><div class="n" id="s-chat">--</div><div class="l">å°è©±æ¨¡å‹</div></div>
  <div class="stat-box"><div class="n" id="s-code">--</div><div class="l">ç¨‹å¼ç¢¼æ¨¡å‹</div></div>
  <div class="stat-box"><div class="n" id="s-vision">--</div><div class="l">è¦–è¦ºæ¨¡å‹</div></div>
  <div class="stat-box"><div class="n" id="s-reason">--</div><div class="l">æ¨ç†æ¨¡å‹</div></div>
  <div class="stat-box"><div class="n" id="s-embed">--</div><div class="l">åµŒå…¥æ¨¡å‹</div></div>
</div>

<div class="controls">
  <input type="text" class="search-box" id="searchBox" placeholder="æœå°‹æ¨¡å‹åŠŸèƒ½... (ä¾‹: å°è©±, ç¨‹å¼ç¢¼, è¦–è¦º, æ¨ç†)">
  <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
  <button class="filter-btn" data-filter="chat">å°è©±</button>
  <button class="filter-btn" data-filter="code">ç¨‹å¼ç¢¼</button>
  <button class="filter-btn" data-filter="vision">è¦–è¦º</button>
  <button class="filter-btn" data-filter="reason">æ¨ç†</button>
  <button class="filter-btn" data-filter="search">æœå°‹</button>
  <button class="filter-btn" data-filter="embed">åµŒå…¥</button>
  <button class="filter-btn" data-filter="image">åœ–åƒç”Ÿæˆ</button>
  <button class="filter-btn" data-filter="audio">èªéŸ³</button>
  <button class="filter-btn" data-filter="large">å¤§å‹</button>
  <button class="filter-btn" data-filter="enterprise">ä¼æ¥­ç´š</button>
  <button class="filter-btn" data-filter="opensource">é–‹æº</button>
  <button class="filter-btn" data-filter="highspeed">é«˜é€Ÿ</button>
</div>

<div class="model-grid" id="modelGrid">
  <div class="loading">è¼‰å…¥ SEOBAIKE AI å¼•æ“ä¸­...</div>
</div>

<div class="chat-panel" id="chatPanel">
  <div class="chat-header">
    <h3 id="chatModelName">é¸æ“‡æ¨¡å‹</h3>
    <button class="chat-close" onclick="closeChat()">&times;</button>
  </div>
  <div class="chat-messages" id="chatMessages"></div>
  <div class="chat-input-row">
    <input type="text" class="chat-input" id="chatInput" placeholder="è¼¸å…¥è¨Šæ¯..." onkeydown="if(event.key==='Enter')sendChat()">
    <button class="chat-send" id="chatSend" onclick="sendChat()">ç™¼é€</button>
  </div>
</div>

<footer class="footer">
  SEOBAIKE AI è¶…ç´šå¼•æ“ â€” å°ˆåˆ© TW-115100981 â€” å°è·¯å…‰æœ‰é™å…¬å¸
</footer>

<script src="/seobaike-config.js"></script>
<script>
let allModels = []
let currentModel = null
let currentProvider = null
let chatHistory = []

// Capability definitions with icons
const CAPABILITIES = {
  chat:   { icon: 'ğŸ’¬', name: 'å°è©±',     cls: 'tag-chat' },
  code:   { icon: 'âŒ¨ï¸', name: 'ç¨‹å¼ç¢¼',   cls: 'tag-code' },
  vision: { icon: 'ğŸ‘ï¸', name: 'è¦–è¦º',     cls: 'tag-vision' },
  reason: { icon: 'ğŸ§ ', name: 'æ¨ç†',     cls: 'tag-reason' },
  search: { icon: 'ğŸ”', name: 'æœå°‹',     cls: 'tag-search' },
  embed:  { icon: 'ğŸ“', name: 'åµŒå…¥',     cls: 'tag-embed' },
  image:  { icon: 'ğŸ¨', name: 'åœ–åƒç”Ÿæˆ', cls: 'tag-image' },
  audio:  { icon: 'ğŸ”Š', name: 'èªéŸ³',     cls: 'tag-audio' },
  large:  { icon: 'âš¡', name: 'å¤§å‹',     cls: 'tag-large' }
}

// Map to SEOBAIKE display names - strips brand, keeps model identifier
function toBrandedName(id) {
  const parts = id.split('/')
  const raw = parts[parts.length - 1]
  // Clean up common patterns, return a readable name
  return raw
    .replace(/^(nvidia|google|anthropic|meta|openai|deepseek|mistral|groq|cohere|qwen|microsoft|perplexity)[\/\-_]/i, '')
    .replace(/[-_]/g, ' ')
    .replace(/\b\w/g, c => c.toUpperCase())
}

// Determine model tier (replaces brand-based owner display)
function getTier(id, tags) {
  const lower = id.toLowerCase()
  // Enterprise-grade indicators
  if (lower.includes('opus') || lower.includes('pro') || lower.includes('ultra') ||
      lower.includes('4o') || lower.includes('gpt-4') || lower.includes('sonnet') ||
      lower.includes('gemini-pro') || lower.includes('command-r-plus')) {
    return { label: 'ä¼æ¥­ç´š', cls: 'tier-enterprise' }
  }
  // High-speed indicators
  if (lower.includes('turbo') || lower.includes('flash') || lower.includes('instant') ||
      lower.includes('haiku') || lower.includes('mini') || lower.includes('nano') ||
      lower.includes('tiny') || lower.includes('8b') || lower.includes('3b') ||
      lower.includes('1b') || lower.includes('groq')) {
    return { label: 'é«˜é€Ÿ', cls: 'tier-highspeed' }
  }
  // Open source indicators
  if (lower.includes('llama') || lower.includes('mistral') || lower.includes('qwen') ||
      lower.includes('gemma') || lower.includes('phi') || lower.includes('starcoder') ||
      lower.includes('codellama') || lower.includes('deepseek') || lower.includes('yi') ||
      lower.includes('falcon') || lower.includes('mpt') || lower.includes('bloom') ||
      lower.includes('vicuna') || lower.includes('granite')) {
    return { label: 'é–‹æº', cls: 'tier-opensource' }
  }
  return { label: 'ä¼æ¥­ç´š', cls: 'tier-enterprise' }
}

// Estimate speed rating (1-5) based on model size hints
function getSpeedRating(id) {
  const lower = id.toLowerCase()
  if (lower.includes('405b') || lower.includes('355b') || lower.includes('235b') || lower.includes('120b')) return 1
  if (lower.includes('70b') || lower.includes('72b') || lower.includes('65b')) return 2
  if (lower.includes('34b') || lower.includes('40b') || lower.includes('32b') || lower.includes('27b')) return 3
  if (lower.includes('13b') || lower.includes('14b') || lower.includes('8b') || lower.includes('7b')) return 4
  if (lower.includes('3b') || lower.includes('2b') || lower.includes('1b') || lower.includes('mini') ||
      lower.includes('nano') || lower.includes('tiny') || lower.includes('flash') ||
      lower.includes('haiku') || lower.includes('turbo') || lower.includes('instant')) return 5
  return 3
}

// Primary capability icon for the card
function getPrimaryCapIcon(tags) {
  const priority = ['vision', 'code', 'reason', 'search', 'embed', 'image', 'audio', 'chat']
  for (const p of priority) {
    if (tags.includes(p)) return CAPABILITIES[p]?.icon || 'ğŸ’¬'
  }
  return 'ğŸ’¬'
}

function classify(id) {
  const tags = []
  const lower = id.toLowerCase()
  if (lower.includes('code') || lower.includes('starcoder') || lower.includes('devstral') || lower.includes('coder') || (lower.includes('granite') && lower.includes('code'))) tags.push('code')
  if (lower.includes('vision') || lower.includes('fuyu') || lower.includes('kosmos') || lower.includes('deplot') || lower.includes('llava') || lower.includes('gemini')) tags.push('vision')
  if (lower.includes('embed') || lower.includes('bge') || lower.includes('embedding')) tags.push('embed')
  if (lower.includes('r1') || lower.includes('reason') || lower.includes('thinking') || lower.includes('mathstral') || lower.includes('opus') || lower.includes('o1') || lower.includes('o3') || lower.includes('o4')) tags.push('reason')
  if (lower.includes('405b') || lower.includes('235b') || lower.includes('120b') || lower.includes('355b') || lower.includes('100b') || lower.includes('70b') || lower.includes('opus') || lower.includes('4o') || lower.includes('pro')) tags.push('large')
  if (lower.includes('sonar') || lower.includes('search') || lower.includes('perplexity')) tags.push('search')
  if (lower.includes('dall') || lower.includes('sdxl') || lower.includes('stable-diffusion') || lower.includes('imagen') || lower.includes('flux')) tags.push('image')
  if (lower.includes('whisper') || lower.includes('tts') || lower.includes('speech') || lower.includes('audio')) tags.push('audio')
  if (!tags.length) tags.push('chat')
  return tags
}

function tagHtml(tag) {
  const cap = CAPABILITIES[tag]
  if (!cap) return '<span class="tag tag-chat">' + tag + '</span>'
  return '<span class="tag ' + cap.cls + '">' + cap.icon + ' ' + cap.name + '</span>'
}

function renderCapabilityBar() {
  const bar = document.getElementById('capabilityBar')
  const counts = {}
  for (const key of Object.keys(CAPABILITIES)) {
    counts[key] = allModels.filter(m => m.tags.includes(key)).length
  }
  bar.innerHTML = Object.entries(CAPABILITIES).map(([key, cap]) => {
    if (counts[key] === 0) return ''
    return '<div class="cap-chip" data-cap="' + key + '">' +
      '<span class="cap-icon">' + cap.icon + '</span>' +
      '<span class="cap-name">' + cap.name + '</span>' +
      '<span class="cap-count">' + counts[key] + '</span>' +
    '</div>'
  }).join('')

  document.querySelectorAll('.cap-chip').forEach(chip => {
    chip.addEventListener('click', function() {
      const cap = this.dataset.cap
      // Activate matching filter button
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'))
      const btn = document.querySelector('.filter-btn[data-filter="' + cap + '"]')
      if (btn) btn.classList.add('active')
      renderModels(allModels.filter(m => m.tags.includes(cap)))
    })
  })
}

async function loadModels() {
  try {
    const res = await fetch('/api/ai/models')
    const data = await res.json()
    allModels = (data.models || []).map(m => {
      const tags = classify(m.id)
      const tier = getTier(m.id, tags)
      return {
        ...m,
        tags: tags,
        tier: tier,
        displayName: toBrandedName(m.id),
        speedRating: getSpeedRating(m.id),
        primaryIcon: getPrimaryCapIcon(tags),
        // Keep internal fields for API calls
        _provider: m.provider || null,
        _providerName: m.provider_name || m.provider || 'unknown',
      }
    })

    document.getElementById('totalCount').textContent = allModels.length
    document.getElementById('s-total').textContent = allModels.length
    document.getElementById('s-chat').textContent = allModels.filter(m => m.tags.includes('chat')).length
    document.getElementById('s-code').textContent = allModels.filter(m => m.tags.includes('code')).length
    document.getElementById('s-vision').textContent = allModels.filter(m => m.tags.includes('vision')).length
    document.getElementById('s-reason').textContent = allModels.filter(m => m.tags.includes('reason')).length
    document.getElementById('s-embed').textContent = allModels.filter(m => m.tags.includes('embed')).length

    renderCapabilityBar()
    renderModels(allModels)
  } catch(e) {
    document.getElementById('modelGrid').innerHTML = '<div class="loading" style="color:#ff6b6b;">è¼‰å…¥å¤±æ•—: ' + e.message + '</div>'
  }
}

function renderModels(models) {
  const grid = document.getElementById('modelGrid')
  if (!models.length) { grid.innerHTML = '<div class="loading">æ²’æœ‰ç¬¦åˆçš„æ¨¡å‹</div>'; return }
  grid.innerHTML = models.map(m => {
    const tagsHtml = m.tags.map(t => tagHtml(t)).join('')
    const speedPct = (m.speedRating / 5) * 100
    const speedLabels = ['', 'è¶…å¤§', 'å¤§å‹', 'ä¸­å‹', 'å¿«é€Ÿ', 'æ¥µé€Ÿ']
    const prov = m._provider || ''
    return '<div class="model-card" onclick="openChat(\'' + m.id.replace(/'/g,"\\'") + '\',\'' + prov.replace(/'/g,"\\'") + '\')" data-id="' + m.id + '" data-tags="' + m.tags.join(',') + '" data-tier="' + m.tier.label + '">' +
      '<div class="model-cap-icon">' + m.primaryIcon + '</div>' +
      '<div class="model-tier"><span class="tier-label ' + m.tier.cls + '">' + m.tier.label + '</span></div>' +
      '<div class="model-name">' + m.displayName + '</div>' +
      '<div class="model-speed">' +
        '<div class="speed-bar"><div class="speed-fill" style="width:' + speedPct + '%"></div></div>' +
        '<span class="speed-label">' + speedLabels[m.speedRating] + '</span>' +
      '</div>' +
      '<div class="model-tags">' + tagsHtml + '</div>' +
    '</div>'
  }).join('')
}

// Search - matches against display name and capability tags
document.getElementById('searchBox').addEventListener('input', function() {
  const q = this.value.toLowerCase()
  const capNameMap = {}
  for (const [key, cap] of Object.entries(CAPABILITIES)) {
    capNameMap[cap.name] = key
  }
  const filtered = allModels.filter(m => {
    if (m.displayName.toLowerCase().includes(q)) return true
    if (m.id.toLowerCase().includes(q)) return true
    if (m.tier.label.includes(q)) return true
    // Match Chinese capability names
    for (const [name, key] of Object.entries(capNameMap)) {
      if (name.includes(q) && m.tags.includes(key)) return true
    }
    return m.tags.some(t => t.includes(q))
  })
  renderModels(filtered)
})

// Filter buttons - capability-based
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'))
    this.classList.add('active')
    const f = this.dataset.filter
    if (f === 'all') { renderModels(allModels); return }
    // Tier-based filters
    if (f === 'enterprise') { renderModels(allModels.filter(m => m.tier.label === 'ä¼æ¥­ç´š')); return }
    if (f === 'opensource') { renderModels(allModels.filter(m => m.tier.label === 'é–‹æº')); return }
    if (f === 'highspeed') { renderModels(allModels.filter(m => m.tier.label === 'é«˜é€Ÿ')); return }
    // Capability-based filters
    renderModels(allModels.filter(m => m.tags.includes(f)))
  })
})

// Chat - still sends real model id and provider to API internally
function openChat(modelId, provider) {
  currentModel = modelId
  currentProvider = provider || null
  chatHistory = []
  const model = allModels.find(m => m.id === modelId)
  const displayName = model ? model.displayName : modelId.split('/').pop()
  const tierLabel = model ? model.tier.label : ''
  document.getElementById('chatPanel').classList.add('open')
  document.getElementById('chatModelName').textContent = 'SEOBAIKE | ' + displayName + (tierLabel ? ' (' + tierLabel + ')' : '')
  document.getElementById('chatMessages').innerHTML = '<div class="chat-msg bot"><div class="model-label">SEOBAIKE AI</div>æˆ‘æ˜¯ SEOBAIKE AI è¶…ç´šå¼•æ“ã€‚æœ‰ä»€éº¼å¯ä»¥å¹«ä½ çš„ï¼Ÿ</div>'
  document.getElementById('chatInput').focus()
  document.querySelectorAll('.model-card').forEach(c => c.classList.remove('active'))
  const card = document.querySelector('[data-id="' + modelId + '"]')
  if (card) { card.classList.add('active'); card.scrollIntoView({ behavior: 'smooth', block: 'center' }) }
}

function closeChat() {
  document.getElementById('chatPanel').classList.remove('open')
  document.querySelectorAll('.model-card').forEach(c => c.classList.remove('active'))
}

async function sendChat() {
  const input = document.getElementById('chatInput')
  const msg = input.value.trim()
  if (!msg || !currentModel) return
  input.value = ''

  const msgs = document.getElementById('chatMessages')
  msgs.innerHTML += '<div class="chat-msg user">' + msg.replace(/</g,'&lt;') + '</div>'
  msgs.scrollTop = msgs.scrollHeight

  const sendBtn = document.getElementById('chatSend')
  sendBtn.disabled = true
  sendBtn.textContent = '...'
  msgs.innerHTML += '<div class="chat-msg bot" id="typing"><div class="model-label">SEOBAIKE AI</div>æ€è€ƒä¸­...</div>'
  msgs.scrollTop = msgs.scrollHeight

  chatHistory.push({ role: 'user', content: msg })

  try {
    const payload = { model: currentModel, messages: [{ role: 'system', content: 'You are a helpful AI assistant on SEOBAIKE platform. Answer in the same language the user writes in.' }, ...chatHistory], max_tokens: 1024 }
    if (currentProvider) payload.provider = currentProvider
    const res = await fetch('/api/ai/nim', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    })
    const data = await res.json()
    const reply = data.reply || data.error || 'No response'
    chatHistory.push({ role: 'assistant', content: reply })

    const typing = document.getElementById('typing')
    if (typing) typing.remove()
    const tokenInfo = data.usage ? ' | ' + (data.usage.total_tokens || 0) + ' tokens' : ''
    msgs.innerHTML += '<div class="chat-msg bot"><div class="model-label">SEOBAIKE AI' + tokenInfo + '</div>' + reply.replace(/</g,'&lt;').replace(/\n/g,'<br>') + '</div>'
  } catch(e) {
    const typing = document.getElementById('typing')
    if (typing) typing.remove()
    msgs.innerHTML += '<div class="chat-msg bot" style="color:#ff6b6b;">Error: ' + e.message + '</div>'
  }

  sendBtn.disabled = false
  sendBtn.textContent = 'ç™¼é€'
  msgs.scrollTop = msgs.scrollHeight
}

// Track
if (window.__SEOBAIKE__) {
  fetch((window.__SEOBAIKE__.supabaseUrl || '') + '/rest/v1/page_views', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'apikey': window.__SEOBAIKE__.anonKey || '', 'Authorization': 'Bearer ' + (window.__SEOBAIKE__.anonKey || ''), 'Prefer': 'return=minimal' },
    body: JSON.stringify({ page: '/ai', referrer: document.referrer || null, user_agent: navigator.userAgent })
  }).catch(() => {})
}

loadModels()
</script>
</body>
</html>
